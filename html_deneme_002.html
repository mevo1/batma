<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin (BTC) Grafiği</title>
    <script src="https://unpkg.com/lightweight-charts@3.6.0/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        #chart-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        #chart, #indicator-chart, #second-indicator-chart {
            width: 1300px;
            height: 400px;
        }
        #indicator-chart, #second-indicator-chart {
            height: 150px;
            display: none;
        }
        #indicator-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #f3f3f3;
            padding: 10px;
            border: 1px solid #ccc;
            font-size: 12px;
        }
        #pine-editor {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 250px;
            height: 150px;
            background-color: #f9f9f9;
            border: 1px solid #ccc;
            padding: 10px;
            font-size: 12px;
        }
        .indicator-button {
            margin: 5px 0;
            padding: 5px;
            width: 100%;
        }
        .editable {
            border: 1px solid #ccc;
            padding: 5px;
            background-color: #ffffff;
            font-family: monospace;
            width: 100%;
            height: 100%;
            resize: none;
        }
    </style>
</head>
<body>
    <h1>Bitcoin (BTC) Grafiği</h1>
    <select id="interval-select" onchange="updateChart()">
        <option value="1d">1 Gün</option>
        <option value="15m">15 Dakika</option>
        <option value="5m">5 Dakika</option>
    </select>
    
    <div id="chart-container">
        <div id="chart"></div>
        <div id="indicator-chart"></div>
        <div id="second-indicator-chart"></div>
    </div>

    <div id="indicator-controls">
        <h3>İndikatörler</h3>
        <button class="indicator-button" onclick="addRSI()">RSI Ekle</button>
        <button class="indicator-button" onclick="addStochRSI()">Stoch RSI Ekle</button>
        <button class="indicator-button" onclick="toggleCombinedView()">Tek/Çift Grafik Görünümü</button>
        <button class="indicator-button" onclick="removeIndicators()">İndikatörleri Kaldır</button>
        <button class="indicator-button" onclick="toggleMagnet()">Mıknatıs Özelliğini Aç/Kapa</button>
    </div>

    <div id="pine-editor">
        <strong>Pine Editör</strong>
        <textarea class="editable" placeholder="TradingView Pine Editör Alanı"></textarea>
    </div>

    <script>
        const chart = LightweightCharts.createChart(document.getElementById('chart'), {
            width: 800,
            height: 400,
            layout: { backgroundColor: '#ffffff', textColor: '#333' },
            grid: { vertLines: { color: '#eee' }, horzLines: { color: '#eee' } },
            priceScale: { borderColor: '#cccccc' },
            timeScale: { borderColor: '#cccccc' },
        });

        const candleSeries = chart.addCandlestickSeries();

        const indicatorChart = LightweightCharts.createChart(document.getElementById('indicator-chart'), {
            width:  800,
            height: 150,
            layout: { backgroundColor: '#ffffff', textColor: '#333' },
            grid: { vertLines: { color: '#eee' }, horzLines: { color: '#eee' } },
            timeScale: { borderColor: '#cccccc' },
        });

        const secondIndicatorChart = LightweightCharts.createChart(document.getElementById('second-indicator-chart'), {
            width: 1300,
            height: 150,
            layout: { backgroundColor: '#ffffff', textColor: '#333' },
            grid: { vertLines: { color: '#eee' }, horzLines: { color: '#eee' } },
            timeScale: { borderColor: '#cccccc' },
        });

        let rsiSeries, stochRsiSeries;
        let combinedView = true;
        let magnetEnabled = false;

        function toggleMagnet() {
            magnetEnabled = !magnetEnabled;
            console.log(`Mıknatıs ${magnetEnabled ? 'açıldı' : 'kapandı'}`);
            document.querySelector('.indicator-button[onclick="toggleMagnet()"]').textContent = 
                `Mıknatıs Özelliğini ${magnetEnabled ? 'Kapat' : 'Aç'}`;
        }

        function generateRandomRSIData() {
            let data = [];
            let value = 50;
            for (let i = 0; i < 100; i++) {
                value += (Math.random() - 0.5) * 10;
                data.push({ time: Math.floor(Date.now() / 1000) - (100 - i) * 60, value: Math.max(0, Math.min(100, value)) });
            }
            return data;
        }

        function generateRandomStochRSIData() {
            let data = [];
            let value = 50;
            for (let i = 0; i < 100; i++) {
                value += (Math.random() - 0.5) * 10;
                data.push({ time: Math.floor(Date.now() / 1000) - (100 - i) * 60, value: Math.max(0, Math.min(100, value)) });
            }
            return data;
        }

        function addRSI() {
            document.getElementById('indicator-chart').style.display = 'block';
            if (!rsiSeries) {
                rsiSeries = (combinedView ? indicatorChart : secondIndicatorChart).addLineSeries({ color: 'blue', lineWidth: 2 });
                rsiSeries.setData(generateRandomRSIData());
            }
        }

        function addStochRSI() {
            document.getElementById('second-indicator-chart').style.display = combinedView ? 'block' : 'none';
            if (!stochRsiSeries) {
                stochRsiSeries = (combinedView ? indicatorChart : secondIndicatorChart).addLineSeries({ color: 'orange', lineWidth: 2 });
                stochRsiSeries.setData(generateRandomStochRSIData());
            }
        }

        function toggleCombinedView() {
            combinedView = !combinedView;
            document.getElementById('second-indicator-chart').style.display = combinedView ? 'none' : 'block';
            removeIndicators();
            addRSI();
            addStochRSI();
        }

        function removeIndicators() {
            if (rsiSeries) {
                (combinedView ? indicatorChart : secondIndicatorChart).removeSeries(rsiSeries);
                rsiSeries = null;
            }
            if (stochRsiSeries) {
                (combinedView ? indicatorChart : secondIndicatorChart).removeSeries(stochRsiSeries);
                stochRsiSeries = null;
            }
            document.getElementById('indicator-chart').style.display = 'none';
            document.getElementById('second-indicator-chart').style.display = 'none';
        }

        const fetchCandleData = async (interval) => {
            const response = await fetch(`https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=${interval}&limit=100`);
            const data = await response.json();
            return data.map(candle => ({
                time: candle[0] / 1000,
                open: parseFloat(candle[1]),
                high: parseFloat(candle[2]),
                low: parseFloat(candle[3]),
                close: parseFloat(candle[4]),
            }));
        };

        const updateChart = async () => {
            const interval = document.getElementById('interval-select').value;
            const data = await fetchCandleData(interval);
            candleSeries.setData(data);
        };

        updateChart();
    </script>
</body>
</html>
